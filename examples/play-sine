#!perl6

use v6.c;

use NativeCall;
use Audio::PortAudio;

multi sub MAIN(:$frequency = 440, :$samplerate = 44100 ) {
	my Num @sin =  (0 .. ($samplerate/$frequency)).map({ sin(($_/($samplerate/$frequency)) * (2 * pi))});
	my @out = flat (@sin Z @sin) xx 512;

	my CArray @n;

	for @out.rotor(1024) -> @a {
		@n.append: CArray[num32].new(@a);
	}

	my $pa = Audio::PortAudio.new;
	my $st = $pa.open-default-stream(0,2, Audio::PortAudio::Float32, $samplerate);

	$st.start;
	loop {
		for @n -> $b {
			$st.write($b, 512);
		}
	}
}

# vim: expandtab shiftwidth=4 ft=perl6
